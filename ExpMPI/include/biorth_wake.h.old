// This may look like C code, but it is really -*- C++ -*-

// Wake generation class

#ifndef _biorth_wake_h
#ifdef __GNUG__
#pragma interface
#endif
#define _biorth_wake_h 1

static const char rcsid_biorth_wake[] = "$Id$";

#include <biorth.h>

class BiorthWake
{

private:

  AxiSymBiorth *bio;
  int lmax, nmax;

  Matrix norm_grid;		// Stored as the sqr root of normalization
				// for efficiency in wake reconstruction

  Logic coefs_defined;
  Matrix factorial;
  Matrix expcoef;
  double rscl;
  int used;

  void accumulate_2d(double x, double y, double mass);
  void accumulate_3d(double x, double y, double z, double mass);

  void reconstruct_2d(double r, double phi,
		      double& dens0, double& dens, 
		      double& potl0, double& potl,
		      int L1=0, int L2=10000);

  void reconstruct_3d(double r, double costh, double phi,
		      double& dens0, double& dens, 
		      double& potl0, double& potl,
		      int L1=0, int L2=10000);

  void bomb(char *s);

public:

// Constructor
  BiorthWake(AxiSymBiorth *BIO, int LMAX, int NMAX);


// Member functions
  void set_scale(const double scl) { rscl = scl; }
  void reset_coefs(void);

  void accumulate(double x, double y, double z, double mass);

  void reconstruct(double r, double costh, double phi,
			     double& dens0, double& dens, 
			     double& potl0, double& potl,
			     int L1=0, int L2=10000);

};


#endif
